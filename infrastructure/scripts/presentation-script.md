#!/bin/bash

# =============================================================================
# Roteiro de Apresenta√ß√£o FIAP-X - Sistema de Processamento de V√≠deos
# =============================================================================
# Dura√ß√£o Total: 10 minutos
# Estrutura: 7 se√ß√µes principais
# =============================================================================

# SE√á√ÉO 1: DOCUMENTA√á√ÉO E ARQUITETURA (2 minutos)
# =============================================================================
echo "üìñ SE√á√ÉO 1: DOCUMENTA√á√ÉO E ARQUITETURA (2 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Apresentar a arquitetura de microsservi√ßos"
echo "- Destacar funcionalidades implementadas"
echo "- Mostrar cobertura de testes (84.6%)"
echo "- Explicar decis√µes t√©cnicas"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Abrir DOCUMENTACAO-ARQUITETURA.md"
echo "2. Navegar pelos componentes:"
echo "   - API Gateway (port 8080)"
echo "   - Processing Service (Go + FFmpeg)"
echo "   - Notification Service (Go + SES)"
echo "   - Frontend (React + Bootstrap)"
echo "   - Banco PostgreSQL + Redis Cache"
echo "3. Mostrar diagramas de arquitetura"
echo "4. Destacar padr√µes implementados:"
echo "   - Circuit Breaker"
echo "   - Retry with Exponential Backoff"
echo "   - Health Checks"
echo "   - Graceful Shutdown"
echo "5. Exibir m√©tricas de qualidade do c√≥digo"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'Bem-vindos √† apresenta√ß√£o do FIAP-X, nosso sistema de processamento'"
echo "'de v√≠deos baseado em microsservi√ßos. A arquitetura foi projetada'"
echo "'para ser resiliente, escal√°vel e observ√°vel, seguindo as melhores'"
echo "'pr√°ticas de desenvolvimento cloud-native.'"
echo ""

# SE√á√ÉO 2: AMBIENTE E INFRAESTRUTURA (1.5 minutos)
# =============================================================================
echo "üèóÔ∏è SE√á√ÉO 2: AMBIENTE E INFRAESTRUTURA (1.5 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Mostrar cluster Kubernetes na AWS"
echo "- Demonstrar pods em execu√ß√£o"
echo "- Exibir servi√ßos e HPA configurados"
echo "- Validar sa√∫de dos microsservi√ßos"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Conectar ao cluster AWS via SSH:"
echo "   ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click"
echo ""
echo "2. Executar comandos kubectl:"
echo "   kubectl get pods -A | grep -E 'fiapx|monitoring'"
echo "   kubectl get svc -n fiapx"
echo "   kubectl get hpa -n fiapx"
echo "   kubectl top nodes"
echo "   kubectl top pods -n fiapx"
echo ""
echo "3. Mostrar status dos servi√ßos:"
echo "   kubectl get deployments -n fiapx"
echo "   kubectl get ingress -n fiapx"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'Aqui temos nosso ambiente de produ√ß√£o rodando em Kubernetes na AWS.'"
echo "'Todos os microsservi√ßos est√£o saud√°veis e o Horizontal Pod Autoscaler'"
echo "'est√° configurado para escalar automaticamente baseado na CPU.'"
echo ""

# SE√á√ÉO 3: DEMONSTRA√á√ÉO PR√ÅTICA - USU√ÅRIO (1 minuto)
# =============================================================================
echo "üë§ SE√á√ÉO 3: DEMONSTRA√á√ÉO PR√ÅTICA - USU√ÅRIO (1 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Demonstrar interface do usu√°rio"
echo "- Realizar cadastro no sistema"
echo "- Mostrar responsividade da UI"
echo "- Validar funcionalidades b√°sicas"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Abrir https://fiapx.wecando.click"
echo "2. Navegar pela landing page"
echo "3. Ir para se√ß√£o de cadastro"
echo "4. Preencher formul√°rio:"
echo "   - Nome: Demo User"
echo "   - Email: demo@fiapx.com"
echo "   - Password: Demo123@"
echo "5. Registrar usu√°rio"
echo "6. Fazer login no sistema"
echo "7. Explorar dashboard principal"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'A interface foi desenvolvida com foco na experi√™ncia do usu√°rio,'"
echo "'utilizando Bootstrap para garantir responsividade e acessibilidade.'"
echo "'O processo de registro √© simples e inclui valida√ß√µes tanto no'"
echo "'frontend quanto no backend.'"
echo ""

# SE√á√ÉO 4: UPLOAD E PROCESSAMENTO (2 minutos)
# =============================================================================
echo "üì§ SE√á√ÉO 4: UPLOAD E PROCESSAMENTO (2 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Demonstrar upload de m√∫ltiplos v√≠deos"
echo "- Mostrar processamento em tempo real"
echo "- Exibir fila de jobs"
echo "- Acompanhar status de progresso"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Navegar para se√ß√£o de upload"
echo "2. Selecionar m√∫ltiplos arquivos de v√≠deo"
echo "3. Configurar par√¢metros de processamento:"
echo "   - Formato de sa√≠da: MP4"
echo "   - Qualidade: 1080p"
echo "   - FPS: 30"
echo "4. Iniciar upload"
echo "5. Acompanhar barra de progresso"
echo "6. Mostrar jobs na fila (PENDING ‚Üí PROCESSING)"
echo "7. Abrir logs de processamento em tempo real"
echo "8. Demonstrar notifica√ß√£o por email (SES)"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'O sistema suporta upload simult√¢neo de m√∫ltiplos v√≠deos com'"
echo "'processamento paralelo usando FFmpeg. Cada job √© rastreado'"
echo "'individualmente e o usu√°rio recebe notifica√ß√µes por email'"
echo "'sobre o status do processamento.'"
echo ""

# SE√á√ÉO 5: OBSERVABILIDADE E MONITORAMENTO (2 minutos)
# =============================================================================
echo "üìä SE√á√ÉO 5: OBSERVABILIDADE E MONITORAMENTO (2 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Apresentar stack de observabilidade"
echo "- Mostrar m√©tricas no Prometheus"
echo "- Explorar dashboards do Grafana"
echo "- Demonstrar alertas configurados"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Abrir Prometheus (localhost:9090)"
echo "2. Executar queries importantes:"
echo "   - up{job='processing-service'}"
echo "   - http_requests_total"
echo "   - video_processing_duration_seconds"
echo "   - go_memstats_alloc_bytes"
echo ""
echo "3. Abrir Grafana (localhost:3000)"
echo "4. Explorar dashboards customizados:"
echo "   - FIAP-X System Overview"
echo "   - Processing Service Metrics"
echo "   - Infrastructure Health"
echo "   - Business Metrics"
echo ""
echo "5. Mostrar alertas configurados:"
echo "   - High CPU Usage"
echo "   - Processing Failures"
echo "   - Response Time Degradation"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'A observabilidade √© fundamental para sistemas em produ√ß√£o.'"
echo "'Implementamos monitoramento completo com Prometheus e Grafana,'"
echo "'coletando m√©tricas de neg√≥cio, performance e infraestrutura.'"
echo "'Os alertas nos permitem responder proativamente a problemas.'"
echo ""

# SE√á√ÉO 6: CI/CD E AUTO-SCALING (1.5 minutos)
# =============================================================================
echo "üîÑ SE√á√ÉO 6: CI/CD E AUTO-SCALING (1.5 min)"
echo ""
echo "üéØ Objetivos:"
echo "- Demonstrar pipeline GitHub Actions"
echo "- Mostrar deploy autom√°tico"
echo "- Simular auto-scaling em a√ß√£o"
echo "- Validar rollback autom√°tico"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Abrir GitHub Actions workflows"
echo "2. Mostrar pipeline em execu√ß√£o:"
echo "   - Testes automatizados"
echo "   - Security scanning"
echo "   - Build multi-arquitetura"
echo "   - Deploy para Kubernetes"
echo ""
echo "3. Simular carga para triggerar HPA:"
echo "   kubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh"
echo "   while true; do wget -q -O- https://fiapx.wecando.click/api/health; done"
echo ""
echo "4. Monitorar auto-scaling:"
echo "   kubectl get hpa -w -n fiapx"
echo "   kubectl get pods -w -n fiapx"
echo ""
echo "5. Mostrar m√©tricas de scaling no Grafana"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'O pipeline CI/CD garante qualidade e confiabilidade dos deploys.'"
echo "'O Horizontal Pod Autoscaler monitora CPU e escalona automaticamente'"
echo "'os pods quando necess√°rio, garantindo performance mesmo com'"
echo "'picos de tr√°fego.'"
echo ""

# SE√á√ÉO 7: DOWNLOAD DOS RESULTADOS (45 segundos)
# =============================================================================
echo "üíæ SE√á√ÉO 7: DOWNLOAD DOS RESULTADOS (45s)"
echo ""
echo "üéØ Objetivos:"
echo "- Mostrar jobs completados"
echo "- Realizar download dos resultados"
echo "- Validar qualidade dos v√≠deos processados"
echo "- Demonstrar formato de entrega"
echo ""
echo "üé¨ A√ß√µes de grava√ß√£o:"
echo "1. Voltar ao dashboard web"
echo "2. Verificar jobs com status COMPLETED"
echo "3. Clicar no bot√£o de download"
echo "4. Baixar arquivo ZIP com resultados"
echo "5. Abrir ZIP e mostrar conte√∫do:"
echo "   - V√≠deos processados"
echo "   - Frames extra√≠dos"
echo "   - Metadados do processamento"
echo "   - Logs de execu√ß√£o"
echo "6. Reproduzir v√≠deo processado"
echo ""
echo "üí¨ Script de narra√ß√£o:"
echo "'O sistema entrega os resultados em formato ZIP organizado,'"
echo "'incluindo v√≠deos processados, frames extra√≠dos e metadados'"
echo "'completos. A qualidade do processamento atende aos requisitos'"
echo "'t√©cnicos especificados.'"
echo ""

# CONCLUS√ÉO E PR√ìXIMOS PASSOS
# =============================================================================
echo "üéâ CONCLUS√ÉO (Opcional - 30s extra)"
echo ""
echo "üéØ Pontos principais cobertos:"
echo "‚úÖ Arquitetura de microsservi√ßos resiliente"
echo "‚úÖ Processamento paralelo e escal√°vel"
echo "‚úÖ Observabilidade completa"
echo "‚úÖ CI/CD automatizado"
echo "‚úÖ Interface responsiva e intuitiva"
echo "‚úÖ Seguran√ßa e boas pr√°ticas"
echo ""
echo "üí¨ Script de encerramento:"
echo "'O FIAP-X demonstra a implementa√ß√£o completa de um sistema'"
echo "'cloud-native moderno, seguindo as melhores pr√°ticas de'"
echo "'desenvolvimento, seguran√ßa e opera√ß√µes. O sistema est√°'"
echo "'pronto para produ√ß√£o e pode escalar conforme a demanda.'"
echo "'Obrigado pela aten√ß√£o!'"
echo ""

# COMANDOS DE SUPORTE DURANTE A GRAVA√á√ÉO
# =============================================================================
echo "üõ†Ô∏è COMANDOS DE SUPORTE PARA GRAVA√á√ÉO:"
echo ""
echo "# Verificar status geral"
echo "kubectl get all -n fiapx"
echo ""
echo "# Logs em tempo real"
echo "kubectl logs -f deployment/processing-service -n fiapx"
echo "kubectl logs -f deployment/notification-service -n fiapx"
echo ""
echo "# For√ßar restart se necess√°rio"
echo "kubectl rollout restart deployment/processing-service -n fiapx"
echo ""
echo "# Verificar recursos"
echo "kubectl top pods -n fiapx"
echo "kubectl describe hpa -n fiapx"
echo ""
echo "# Port-forwards para desenvolvimento"
echo "kubectl port-forward svc/prometheus-grafana 3000:80 -n monitoring &"
echo "kubectl port-forward svc/prometheus-kube-prometheus-prometheus 9090:9090 -n monitoring &"
echo ""

# CHECKLIST PR√â-GRAVA√á√ÉO
# =============================================================================
echo "‚úÖ CHECKLIST PR√â-GRAVA√á√ÉO:"
echo ""
echo "‚ñ° Cluster Kubernetes funcionando"
echo "‚ñ° Todos os pods em status Running"
echo "‚ñ° Frontend acess√≠vel via HTTPS"
echo "‚ñ° Port-forwards configurados (Grafana/Prometheus)"
echo "‚ñ° Arquivos de teste preparados para upload"
echo "‚ñ° Resolu√ß√£o de tela adequada (1920x1080+)"
echo "‚ñ° √Åudio funcionando"
echo "‚ñ° Browser limpo (sem abas desnecess√°rias)"
echo "‚ñ° Notifica√ß√µes do sistema desabilitadas"
echo "‚ñ° Conex√£o de internet est√°vel"
echo ""
echo "üé¨ Para iniciar a grava√ß√£o:"
echo "./generate-presentation-video.sh <minutos>"
echo ""
echo "üéØ Para grava√ß√£o de se√ß√£o espec√≠fica:"
echo "./generate-presentation-video.sh 10 --section <1-7>"
echo ""
echo "üß™ Para teste em modo simula√ß√£o:"
echo "./generate-presentation-video.sh 5 --simulate"
