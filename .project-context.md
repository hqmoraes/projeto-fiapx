# ğŸ¯ CONTEXTO E ORIENTAÃ‡Ã•ES DO PROJETO FIAP-X

## ğŸ“‹ PARÃ‚METROS OBRIGATÃ“RIOS

### ğŸ”— SSH para Worker Node
- **Servidor**: worker.wecando.click
- **UsuÃ¡rio**: ubuntu
- **Chave SSH**: ~/.ssh/keyPrincipal.pem
- **Comando**: `ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click`

### ğŸ³ Docker Hub
- **UsuÃ¡rio**: hmoraes
- **Senha**: Ch@plinh45
- **Login**: `echo "Ch@plinh45" | docker login -u hmoraes --password-stdin`

### ğŸ—ï¸ Processo de Build/Deploy
- **LocalizaÃ§Ã£o**: Sempre no servidor worker via SSH
- **Processo**:
  1. SSH para worker.wecando.click
  2. Copiar cÃ³digo para o servidor (scp)
  3. Build no servidor (docker build)
  4. Push para Docker Hub
  5. Deploy/restart no Kubernetes

## ğŸŒ ARQUITETURA ATUAL (Estado Real)

### URLs de ProduÃ§Ã£o
- **Frontend**: https://fiapx.wecando.click
- **APIs**: https://api.wecando.click
- **SSL**: Let's Encrypt automÃ¡tico via cert-manager

### ğŸ” Auth Service
- **Endpoint**: https://api.wecando.click/auth
- **Porta Interna**: 8082
- **APIs**:
  - `POST /auth/register` - Registro de usuÃ¡rios
  - `POST /auth/login` - Login com JWT
  - `GET /auth/me` - Dados do usuÃ¡rio (JWT obrigatÃ³rio)
### ğŸ“¤ Upload Service
- **Endpoint**: https://api.wecando.click/upload
- **Porta Interna**: 8080
- **APIs**:
  - `POST /upload/upload` - Upload de vÃ­deos (multipart/form-data)
  - `GET /upload/health` - Health check

### âš™ï¸ Processing Service
- **Endpoint**: https://api.wecando.click/processing
- **Porta Interna**: 8080
- **APIs**:
  - `GET /processing/status/{id}` - Status do processamento de vÃ­deo
  - `GET /processing/queue/status` - Status geral da fila
  - `GET /processing/queue/position/{id}` - PosiÃ§Ã£o na fila
  - `GET /processing/metrics` - MÃ©tricas Prometheus
  - `GET /processing/health` - Health check

### ğŸ’¾ Storage Service
- **Endpoint**: https://api.wecando.click/storage
- **Porta Interna**: 8080
- **APIs**:
  - `GET /storage/videos` - Lista vÃ­deos do usuÃ¡rio
  - `GET /storage/videos/{id}` - Detalhes de um vÃ­deo
  - `DELETE /storage/videos/{id}` - Remove vÃ­deo
  - `GET /storage/stats` - EstatÃ­sticas do usuÃ¡rio
  - `GET /storage/download/{id}` - Download do ZIP de frames
  - `GET /storage/health` - Health check

### ğŸ“§ Notification Service
- **Sem Endpoints PÃºblicos** - Apenas worker background
- **Funcionalidade**: Envia emails via Amazon SES baseado em eventos RabbitMQ
## ğŸ—ï¸ INFRAESTRUTURA ATUAL

### ğŸ¯ URLs de ProduÃ§Ã£o (Estado Real)
- **Frontend**: https://fiapx.wecando.click
- **APIs**: https://api.wecando.click
- **Cluster**: Kubernetes autogerenciado em AWS EC2 ARM64
- **SSL**: Let's Encrypt automÃ¡tico via cert-manager

### ğŸ—„ï¸ Componentes de Backend
- **PostgreSQL**: Banco de dados (auth-service)
- **Redis**: Cache para processing-service (porta 6380)
- **RabbitMQ**: Message broker (filas: video_processing, video_processed, notifications)
- **MinIO**: Object storage (buckets: video-uploads, video-processed)
- **Nginx Ingress**: Roteamento HTTPS e SSL

## ğŸš€ PROCESSO DE DEPLOY (Atualizado)

### 1. SSH para Worker Node
```bash
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click
```

### 2. Login Docker Hub
```bash
echo "Ch@plinh45" | docker login -u hmoraes --password-stdin
```

### 3. Build e Push (sempre no worker)
```bash
# Copiar cÃ³digo para worker
scp -i ~/.ssh/keyPrincipal.pem -r <service>/ ubuntu@worker.wecando.click:~/

# Build no worker (ARM64)
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click "cd ~/<service> && docker build -t hmoraes/<service>:latest ."

# Push para Docker Hub
ssh -i ~/.ssh/keyPrincipal.pem ubuntu@worker.wecando.click "docker push hmoraes/<service>:latest"
```

### 4. Deploy/Restart no Kubernetes
```bash
# Apply manifest
kubectl --kubeconfig=kubeconfig.yaml apply -f infrastructure/kubernetes/<service>/

# Restart deployment (forÃ§a pull da nova imagem)
kubectl --kubeconfig=kubeconfig.yaml rollout restart deployment/<service> -n fiapx
```

## âš ï¸ OBSERVAÃ‡Ã•ES CRÃTICAS

- **âœ… NUNCA AWS Amplify**: Frontend estÃ¡ no Kubernetes
- **âœ… Endpoints HTTPS**: Todos via https://api.wecando.click
- **âœ… Build no Worker**: ARM64 obrigatÃ³rio, nunca local
- **âœ… Kubernetes Nativo**: NÃ£o usar IPs externos antigos
- **âœ… SSL AutomÃ¡tico**: Let's Encrypt gerencia certificados
- **âœ… Namespace fiapx**: Todos os recursos no mesmo namespace

---
**Estado Atual**: ProduÃ§Ã£o com HTTPS e SSL automÃ¡tico
**Ãšltima atualizaÃ§Ã£o**: 01/07/2025
**Projeto**: FIAP-X Video Processing Platform
