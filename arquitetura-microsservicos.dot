digraph "Arquitetura de Microsserviços" {
    rankdir=TB;
    node [shape=box, style="filled,rounded", fontname="Arial", margin=0.3];
    edge [fontname="Arial"];
    
    // Título
    subgraph cluster_title {
        label="Arquitetura de Microsserviços - Processamento de Vídeos";
        fontsize=20;
        fontname="Arial Bold";
        style=invis;
        title [shape=none, label="", style=invis];
    }
    
    // Grupo de API Gateway e Autenticação
    subgraph cluster_api_layer {
        style=invis;
        api_gateway [label="API Gateway / Ingress", fillcolor="#dae8fc", color="#6c8ebf"];
        auth_service [label="Serviço de\nAutenticação", fillcolor="#ffe6cc", color="#d79b00"];
    }
    
    // Grupo de Microsserviços
    subgraph cluster_services {
        style=invis;
        upload_service [label="Serviço de Upload\n(API REST)", fillcolor="#d5e8d4", color="#82b366"];
        processing_service [label="Serviço de\nProcessamento", fillcolor="#d5e8d4", color="#82b366"];
        storage_service [label="Serviço de\nArmazenamento", fillcolor="#d5e8d4", color="#82b366"];
    }
    
    // Message Broker
    rabbitmq [label="Message Broker\n(RabbitMQ)", fillcolor="#f8cecc", color="#b85450"];
    
    // Grupo de Bancos de Dados
    subgraph cluster_databases {
        style=invis;
        postgres [label="PostgreSQL\n(Metadados)", shape=cylinder, fillcolor="#e1d5e7", color="#9673a6"];
        redis [label="Redis\n(Cache)", shape=cylinder, fillcolor="#e1d5e7", color="#9673a6"];
        minio [label="MinIO / S3\n(Videos)", shape=cylinder, fillcolor="#e1d5e7", color="#9673a6"];
    }
    
    // Grupo de Monitoramento e CI/CD
    subgraph cluster_ops {
        style=invis;
        monitoring [label="Monitoramento & Logging\n(Prometheus, Grafana, ELK)", fillcolor="#fff2cc", color="#d6b656"];
        cicd [label="CI/CD Pipeline\n(GitHub Actions, Jenkins)", fillcolor="#fff2cc", color="#d6b656"];
    }
    
    // Kubernetes
    kubernetes [label="Kubernetes Cluster", style="filled,rounded,dashed", fillcolor="#f5f5f5", color="#666666"];
    
    // Conexões
    auth_service -> api_gateway [dir=both];
    
    api_gateway -> upload_service;
    api_gateway -> processing_service;
    api_gateway -> storage_service;
    
    upload_service -> rabbitmq;
    processing_service -> rabbitmq [dir=both];
    storage_service -> rabbitmq;
    
    upload_service -> postgres [dir=both];
    rabbitmq -> redis [dir=both];
    rabbitmq -> minio [dir=both];
    
    // Hierarquia
    title -> api_gateway [style=invis];
    title -> auth_service [style=invis];
    
    api_gateway -> upload_service [style=invis, weight=2];
    auth_service -> upload_service [style=invis, weight=2];
    
    upload_service -> rabbitmq [style=invis, weight=2];
    processing_service -> rabbitmq [style=invis, weight=2];
    storage_service -> rabbitmq [style=invis, weight=2];
    
    rabbitmq -> postgres [style=invis, weight=2];
    rabbitmq -> redis [style=invis, weight=2];
    rabbitmq -> minio [style=invis, weight=2];
    
    postgres -> monitoring [style=invis, weight=2];
    redis -> monitoring [style=invis, weight=2];
    minio -> monitoring [style=invis, weight=2];
    
    monitoring -> cicd [style=invis, weight=2];
    cicd -> kubernetes [style=invis, weight=2];
}
